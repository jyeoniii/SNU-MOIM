<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<br><br>
<div *ngIf="loginedUser" style="float:right; margin-right:5%">
  <span>Welcome, </span>{{loginedUser.name}}
  <button [routerLink]="['/user', loginedUser.id, 'message']" class="btn btn-primary btn-primary">Message</button>
  <button (click)="signOut()" class="btn btn-primary btn-primary">SignOut</button>
</div>


<div *ngIf="loginedUser.token_expired">
  <br><br><br>
  <div class="col-sm-offset-3 col-sm-6 alert alert-danger" role="alert" style="text-align: center;">
    It seems your Facebook access token is expired.<br>
    If you don't renew your token, your friends status will not be updated.<br>
    Please <a href="/oauth/login/facebook/" class="alert-link">click here to log in to Facebook</a> again.
  </div>
  <br><br><br>
</div>

<br><br><br>
<div style="text-align:center">
  <h2>View Profile</h2>
</div>

<div *ngIf="user">
  <form class="form-horizontal">
    <div class="form-group">
      <label class="col-sm-6 control-label">mySNU ID</label>
      <div class="col-sm-6">
        <p class="form-control-static">{{user.username}}</p>
      </div>
    </div>
  </form>

  <form class="form-horizontal">
    <div class="form-group">
      <label class="col-sm-6 control-label">Name</label>
      <div class="col-sm-6">
        <p class="form-control-static">{{user.name}}</p>
      </div>
    </div>
  </form>

  <form class="form-horizontal">
    <div class="form-group">
      <label class="col-sm-6 control-label">College</label>
      <div class="col-sm-6">
        <p class="form-control-static">{{user.college.name}}</p>
      </div>
    </div>
  </form>

  <form class="form-horizontal">
    <div class="form-group">
      <label class="col-sm-6 control-label">Interest</label>
      <div class="col-sm-2">
        <div *ngFor="let subject of user.subjects">
          <li class="list-group-item">
            {{subject.name}}
          </li>
        </div>
      </div>
    </div>
  </form>

  <br>

  <!-- Logged in user is on their own profile page -->
  <div *ngIf="status === 0">
    <button class="col-sm-offset-5 col-sm-2 btn btn-primary" (click)="editProfile()">Edit Profile</button>
    <br><br>
    <a href="/oauth/login/facebook/"> <!-- Show Facebook Connect Button -->
      <button *ngIf="!loginedUser.fb_connected" class="col-sm-offset-5 col-sm-2 btn btn-primary">Connect to Facebook</button>
    </a>
  </div>

  <!-- Facebook friend -->
  <div *ngIf="status === 1" class="text-center col-sm-offset-4 col-sm-4 alert alert-info" role="alert">
      You're a friend with this user!
  </div>

  <!-- Show mutual friends -->
  <div *ngIf="status === 2">
    <div *ngIf="mutualFriends.length === 0"
         class="text-center col-sm-offset-4 col-sm-4 alert alert-warning" role="alert">
      There's no mutual friends between you and this user.
    </div>
    <div *ngIf="mutualFriends.length > 0" class="col-sm-offset-4 col-sm-4">
        <li class="list-group-item list-group-item-success" style="text-align: center;">
          <b>Mutual friends between you and this user</b>
        </li>
        <div *ngFor="let friend of mutualFriends">
          <li class="list-group-item" style="text-align: center;">
            {{friend.name}} (username: {{friend.username}})
          </li>
        </div>
    </div>
  </div>

  <!-- This user is not connected to Facebook -->
  <div *ngIf="status === 3" class="text-center col-sm-offset-4 col-sm-4 alert alert-danger" role="alert">
    You're not connected to Facebook.<br>
    <a href="/oauth/login/facebook/" class="alert-link">Connect to Facebook now</a> to see  the mutual friends<br>
    between you and this user!
  </div>

  <!-- The user on profile page is not connected to Facebook -->
  <div *ngIf="status === 4" class="text-center col-sm-offset-4 col-sm-4 alert alert-danger" role="alert">
    Can't get mutual friends because this user is not connected to Facebook.
  </div>

  <br>
  <br>
  <div *ngIf="status > 0 && status < 5">
    <button class="col-sm-offset-5 col-sm-2 btn btn-primary" (click)="sendMessage()">Send Message</button>
  </div>
</div>
